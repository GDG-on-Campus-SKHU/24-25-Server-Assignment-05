# 사용자 관점에서의 로그인 과정 흐름

## 로그인 과정
1. 사용자가 아이디, 비밀번호를 작성하여 제출한다.
2. 비밀번호는 암호화 처리를 거쳐 사용자 정보와 비교하여 인증을한다.
3. 서버에서는 세션id를 발생시킨다.
4. 서버에서 클라이언트로 세션id만 쿠키에 담아서 전달한다.
5. 클라이언트는 요청시 항상 세션id가 담긴 쿠키를 전달한다.
6. 서버에서는 클라이언트가 전달한 쿠키 정보로 로그인 할 때 세션 정보를 이용한다.

로그인 성공 - 아이디, 비밀번호가 데이터베이스 정보와 일치

로그인 실패 - 아이디, 비밀번호가 존재하지 않거나 데이터베이스 정보와 불일치

## 로그인 성공 후 사용자에게 제공되는 경험

- 접근 가능한 페이지 사용이 가능하다.
- 로그인에 성공했다면, 클라이언트는 세션id가 담긴 쿠키를 갖고 있어서 
이 세션id가 자동으로 서버에 전달된다.
- 서버는 클라이언트가 보낸 세션 id를 통해 사용자의 로그인상태를 인식할 수 있다.
  (Spring Security는 요청마다 세션에 저장된 SecurityCntext를 통해
요청마다 인증 정보를 불러와 사용자의 로그인상태를 유지한다.)

--- 

# 서버가 로그인한 사용자를 인식하는 방식

## 로그인상태 유지를 위해 쿠키와 세션은 어떻게 사용될까?
1. 로그인에 성공하면 세션과 세션id가 만들어진다.
   - 서버에서 사용자 정보를 담은 세션 생성
   - 세션을 식별할 수 있는 세션 id는 쿠키에 저장
   
2. API 호출 시 세션id를 통해 사용자를 구별한다.
    클라이언트가 API호출 -> 서버에 세션 id가 담긴 쿠키 전송 -> 서버에서 세션id 추출
-> 세션 저장소에서 세션 조회 

3. 세션에서 인증 정보를 불려온다.
    - spring Security는 불러온 인증 정보를 사용해 사용자의 접근 권한을 확인한다.

4. SecurityContext에 인증 정보를 저장한다.
    - 이후에도 SecurityContext를 참조해서 로그인한 사용자로 접근을 가능하게 한다.

5. 세션을 이용해서 로그인상태를 유지한다.
    - 서버는 API호출마다 세션id를 확인하고, 로그인 상태를 알 수 있다.

## 쿠키는 어떤 역할을 할까?
-> 쿠키는 클라이언트가 세션 id를 서버에 전달하는 수단으로 사용된다.

1. 세션 기반 로그인이에서 쿠키의 역할
    - 세션 id를 저장한다.
    - 클라이언트와 서버 사이에서 세션id를 전달한다.
    - 서버에서 세션 id가 담긴 쿠키를 확인하고, 사용자 인증 정보를 조회 할 수 있다.
    - 세션 id쿠키를 통해서 로그인 상태유지가 가능하다.

2. 세션 id가 쿠키에 저장 되어서 클라이언트와 서버 간에 전달되는 과정
    1. 로그인에 성공하면, 세션 id를 만든다.
    2. 쿠키에 세션 id를 담아서 서버에서 클라이언트로 전송된다.
    3. 클라이언트는 전달받은 쿠키를 저장하고, 이후 클라이언트는 
자동으로 서버에 요청을 보낼 수 있다.
   4. 클라이언트가 서버로 API를 호출할 때, 쿠키에 저장되어 있는 세션 id를
자동으로 전송을 보낸다.
   5. 서버에서는 호출과 함께 온 세션id를 확인하고, 세션 저장소에서
해당 id를 확인하고, 해당 id에 맞는 정보를 불러온다. 

---

# 세션을 구현할 때 보안적으로 고려해야 할 부분은? 
1. 세션 고정 공격 : 공격자가 세션 id를 미리 알고, 피해자가 해당 세션을 사용하도록 하는 공격이다.
    - session.SetAttribute()를 사용해 세션을 새로 시작하고, 사용자는 기존의 세션 id를 사용하지 않을 수 있다.

2. 세션 타임 아웃 : 세션이 너무 긴 시간 활성화 되어 있을 때 악의적인 접근 및 공격이 가능하다.
    - server.servlet.session.timeout을 설정해서 세션의 유효 시간을 설정해 줄 수 있다.

--- 

쿠키 : 웹 서버에서 생성하고 클라이언트로 전송되는 정보파일
세션 : 정보교환을 위한 연결상태

